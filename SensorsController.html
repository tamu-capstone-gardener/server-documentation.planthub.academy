<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: SensorsController
  
    &mdash; Documentation by YARD 0.9.37
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "SensorsController";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (S)</a> &raquo;
    
    
    <span class="title">SensorsController</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: SensorsController
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ActionController::Base</li>
          
            <li class="next"><span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></li>
          
            <li class="next">SensorsController</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>app/controllers/sensors_controller.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Controller for managing sensor data display and notification settings</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Request to view a sensor’s data</p>
</div></h5>
      
      <pre class="example code"><code>GET /sensors/123</code></pre>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Request to update notification settings</p>
</div></h5>
      
      <pre class="example code"><code>PATCH /sensors/123/update_notification_settings</code></pre>
    
  </div>


</div>


  <h2>Constant Summary</h2>
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="ZipCodeHelper.html" title="ZipCodeHelper (module)">ZipCodeHelper</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="ZipCodeHelper.html#CSV_FILE_PATH-constant" title="ZipCodeHelper::CSV_FILE_PATH (constant)">ZipCodeHelper::CSV_FILE_PATH</a></span>, <span class='object_link'><a href="ZipCodeHelper.html#ZIP_ZONE_MAP-constant" title="ZipCodeHelper::ZIP_ZONE_MAP (constant)">ZipCodeHelper::ZIP_ZONE_MAP</a></span></p>





  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#load_notification_settings-instance_method" title="#load_notification_settings (instance method)">#<strong>load_notification_settings</strong>  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Renders the notification settings form for a sensor.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#show-instance_method" title="#show (instance method)">#<strong>show</strong>  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Displays sensor data with time series chart.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#time_series_chart-instance_method" title="#time_series_chart (instance method)">#<strong>time_series_chart</strong>  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Displays time series chart for a sensor with a specific time range.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#toggle_notification-instance_method" title="#toggle_notification (instance method)">#<strong>toggle_notification</strong>  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Toggles notification settings for a sensor.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_notification_settings-instance_method" title="#update_notification_settings (instance method)">#<strong>update_notification_settings</strong>  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Updates notification thresholds and messages for a sensor.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="ZipCodeHelper.html" title="ZipCodeHelper (module)">ZipCodeHelper</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="ZipCodeHelper.html#plant_in_zone%3F-instance_method" title="ZipCodeHelper#plant_in_zone? (method)">#plant_in_zone?</a></span>, <span class='object_link'><a href="ZipCodeHelper.html#zone_for_zip-instance_method" title="ZipCodeHelper#zone_for_zip (method)">#zone_for_zip</a></span></p>

  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="load_notification_settings-instance_method">
  
    #<strong>load_notification_settings</strong>  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Renders the notification settings form for a sensor</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>ID of the sensor to load settings for</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


115
116
117
118</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/sensors_controller.rb', line 115</span>

<span class='kw'>def</span> <span class='id identifier rubyid_load_notification_settings'>load_notification_settings</span>
  <span class='ivar'>@sensor</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Sensor.html" title="Sensor (class)">Sensor</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_render'>render</span> <span class='label'>partial:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sensors/notification_form</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>locals:</span> <span class='lbrace'>{</span> <span class='label'>sensor:</span> <span class='ivar'>@sensor</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="show-instance_method">
  
    #<strong>show</strong>  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Displays sensor data with time series chart</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>ID of the sensor to display</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>start_date</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>optional start date for time range</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>days</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>optional number of days to show (default: 10)</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/sensors_controller.rb', line 15</span>

<span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
  <span class='ivar'>@sensor</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Sensor.html" title="Sensor (class)">Sensor</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>

  <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_use_zone'>use_zone</span><span class='lparen'>(</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_zone'>zone</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:start_date</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
      <span class='id identifier rubyid_start_time'>start_time</span> <span class='op'>=</span> <span class='const'>Date</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:start_date</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_days'>days</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:days</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>?</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:days</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>:</span> <span class='int'>10</span>
      <span class='id identifier rubyid_start_time'>start_time</span> <span class='op'>=</span> <span class='id identifier rubyid_days'>days</span><span class='period'>.</span><span class='id identifier rubyid_days'>days</span><span class='period'>.</span><span class='id identifier rubyid_ago'>ago</span>
    <span class='kw'>end</span>


    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Time zone is </span><span class='embexpr_beg'>#{</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_zone'>zone</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='ivar'>@time_series_data</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="TimeSeriesDatum.html" title="TimeSeriesDatum (class)">TimeSeriesDatum</a></span></span>
                        <span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>sensor_id:</span> <span class='ivar'>@sensor</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
                        <span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>timestamp &gt;= ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_start_time'>start_time</span><span class='rparen'>)</span>
                        <span class='period'>.</span><span class='id identifier rubyid_group_by_minute'>group_by_minute</span><span class='lparen'>(</span><span class='symbol'>:timestamp</span><span class='comma'>,</span> <span class='label'>time_zone:</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_zone'>zone</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
                        <span class='period'>.</span><span class='id identifier rubyid_average'>average</span><span class='lparen'>(</span><span class='symbol'>:value</span><span class='rparen'>)</span>
                        <span class='period'>.</span><span class='id identifier rubyid_transform_values'>transform_values</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
                          <span class='kw'>next</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                          <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span>
                          <span class='kw'>if</span> <span class='ivar'>@sensor</span><span class='period'>.</span><span class='id identifier rubyid_measurement_type'>measurement_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>light_analog</span><span class='tstring_end'>&quot;</span></span>
                            <span class='lparen'>(</span><span class='lparen'>(</span><span class='int'>4096</span> <span class='op'>-</span> <span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span> <span class='op'>/</span> <span class='float'>4096.0</span> <span class='op'>*</span> <span class='int'>100</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_round'>round</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span>
                          <span class='kw'>else</span>
                            <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_round'>round</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span>
                          <span class='kw'>end</span>
                        <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
    <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span>
    <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_turbo_stream'>turbo_stream</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_render'>render</span> <span class='label'>turbo_stream:</span> <span class='id identifier rubyid_turbo_stream'>turbo_stream</span><span class='period'>.</span><span class='id identifier rubyid_replace'>replace</span><span class='lparen'>(</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sensor_chart</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
        <span class='label'>partial:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sensors/chart</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
        <span class='label'>locals:</span> <span class='lbrace'>{</span> <span class='label'>sensor:</span> <span class='ivar'>@sensor</span><span class='comma'>,</span> <span class='label'>time_series_data:</span> <span class='ivar'>@time_series_data</span> <span class='rbrace'>}</span>
      <span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="time_series_chart-instance_method">
  
    #<strong>time_series_chart</strong>  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Displays time series chart for a sensor with a specific time range</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>ID of the sensor to display</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>range</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>time range to display (“1_day”, “7_days”, “30_days”, “365_days”)</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/sensors_controller.rb', line 125</span>

<span class='kw'>def</span> <span class='id identifier rubyid_time_series_chart'>time_series_chart</span>
  <span class='ivar'>@sensor</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Sensor.html" title="Sensor (class)">Sensor</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_range'>range</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:range</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>30_days</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_time_ago'>time_ago</span> <span class='op'>=</span> <span class='kw'>case</span> <span class='id identifier rubyid_range'>range</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1_day</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>then</span> <span class='int'>1</span><span class='period'>.</span><span class='id identifier rubyid_day'>day</span><span class='period'>.</span><span class='id identifier rubyid_ago'>ago</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>7_days</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>then</span> <span class='int'>7</span><span class='period'>.</span><span class='id identifier rubyid_days'>days</span><span class='period'>.</span><span class='id identifier rubyid_ago'>ago</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>30_days</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>then</span> <span class='int'>30</span><span class='period'>.</span><span class='id identifier rubyid_days'>days</span><span class='period'>.</span><span class='id identifier rubyid_ago'>ago</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>365_days</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>then</span> <span class='int'>1</span><span class='period'>.</span><span class='id identifier rubyid_year'>year</span><span class='period'>.</span><span class='id identifier rubyid_ago'>ago</span>
  <span class='kw'>else</span> <span class='int'>30</span><span class='period'>.</span><span class='id identifier rubyid_days'>days</span><span class='period'>.</span><span class='id identifier rubyid_ago'>ago</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_hourly_data'>hourly_data</span> <span class='op'>=</span> <span class='ivar'>@sensor</span><span class='period'>.</span><span class='id identifier rubyid_time_series_data'>time_series_data</span>
                      <span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>timestamp &gt;= ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_time_ago'>time_ago</span><span class='rparen'>)</span>
                      <span class='period'>.</span><span class='id identifier rubyid_group_by_hour'>group_by_hour</span><span class='lparen'>(</span><span class='symbol'>:timestamp</span><span class='comma'>,</span> <span class='label'>time_zone:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Central Time (US &amp; Canada)</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
                      <span class='period'>.</span><span class='id identifier rubyid_average'>average</span><span class='lparen'>(</span><span class='symbol'>:value</span><span class='rparen'>)</span>
                      <span class='period'>.</span><span class='id identifier rubyid_transform_values'>transform_values</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
                        <span class='kw'>next</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                        <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span>
                        <span class='kw'>if</span> <span class='ivar'>@sensor</span><span class='period'>.</span><span class='id identifier rubyid_measurement_type'>measurement_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>light_analog</span><span class='tstring_end'>&quot;</span></span>
                          <span class='lparen'>(</span><span class='lparen'>(</span><span class='int'>4096</span> <span class='op'>-</span> <span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span> <span class='op'>/</span> <span class='float'>4096.0</span> <span class='op'>*</span> <span class='int'>100</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_round'>round</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span>
                        <span class='kw'>else</span>
                          <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_round'>round</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span>
                        <span class='kw'>end</span>
                      <span class='kw'>end</span>

  <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Replacing the chart for </span><span class='embexpr_beg'>#{</span><span class='ivar'>@sensor</span><span class='period'>.</span><span class='id identifier rubyid_measurement_type'>measurement_type</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_render'>render</span> <span class='label'>turbo_stream:</span> <span class='id identifier rubyid_turbo_stream'>turbo_stream</span><span class='period'>.</span><span class='id identifier rubyid_replace'>replace</span><span class='lparen'>(</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>chart-</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='label'>partial:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sensors/sensor_chart_inline</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='label'>locals:</span> <span class='lbrace'>{</span> <span class='label'>sensor:</span> <span class='ivar'>@sensor</span><span class='comma'>,</span> <span class='label'>data:</span> <span class='id identifier rubyid_hourly_data'>hourly_data</span> <span class='rbrace'>}</span>
  <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="toggle_notification-instance_method">
  
    #<strong>toggle_notification</strong>  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Toggles notification settings for a sensor</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>ID of the sensor to update</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


60
61
62
63
64
65
66
67
68
69
70
71
72
73
74</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/sensors_controller.rb', line 60</span>

<span class='kw'>def</span> <span class='id identifier rubyid_toggle_notification'>toggle_notification</span>
  <span class='ivar'>@sensor</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Sensor.html" title="Sensor (class)">Sensor</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@sensor</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='label'>notifications:</span> <span class='op'>!</span><span class='ivar'>@sensor</span><span class='period'>.</span><span class='id identifier rubyid_notifications'>notifications</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
    <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_turbo_stream'>turbo_stream</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_render'>render</span> <span class='label'>turbo_stream:</span> <span class='id identifier rubyid_turbo_stream'>turbo_stream</span><span class='period'>.</span><span class='id identifier rubyid_replace'>replace</span><span class='lparen'>(</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>notification_section</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
        <span class='label'>partial:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sensors/notification_section</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
        <span class='label'>locals:</span> <span class='lbrace'>{</span> <span class='label'>sensor:</span> <span class='ivar'>@sensor</span> <span class='rbrace'>}</span>
      <span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_plant_module_sensor_path'>plant_module_sensor_path</span><span class='lparen'>(</span><span class='ivar'>@sensor</span><span class='period'>.</span><span class='id identifier rubyid_plant_module'>plant_module</span><span class='comma'>,</span> <span class='ivar'>@sensor</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_notification_settings-instance_method">
  
    #<strong>update_notification_settings</strong>  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Updates notification thresholds and messages for a sensor</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>ID of the sensor to update</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>comparisons</span>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>comparison operators for thresholds</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>values</span>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>threshold values</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>messages</span>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>notification messages</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>sensor</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>sensor parameters</p>
</div>
      
    </li>
  
</ul>

  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/sensors_controller.rb', line 85</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_notification_settings'>update_notification_settings</span>
  <span class='ivar'>@sensor</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Sensor.html" title="Sensor (class)">Sensor</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_comparisons'>comparisons</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:comparisons</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_values'>values</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:values</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_messages'>messages</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:messages</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_thresholds'>thresholds</span> <span class='op'>=</span> <span class='id identifier rubyid_comparisons'>comparisons</span><span class='period'>.</span><span class='id identifier rubyid_zip'>zip</span><span class='lparen'>(</span><span class='id identifier rubyid_values'>values</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_comp'>comp</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='op'>|</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_comp'>comp</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_val'>val</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_notifications'>notifications</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:sensor</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:notifications</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span>

  <span class='kw'>if</span> <span class='ivar'>@sensor</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='label'>thresholds:</span> <span class='id identifier rubyid_thresholds'>thresholds</span><span class='comma'>,</span> <span class='label'>messages:</span> <span class='id identifier rubyid_messages'>messages</span><span class='comma'>,</span> <span class='label'>notifications:</span> <span class='id identifier rubyid_notifications'>notifications</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Notification settings updated.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='lbracket'>[</span><span class='symbol'>:alert</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to update settings.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
    <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_turbo_stream'>turbo_stream</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_render'>render</span> <span class='label'>turbo_stream:</span> <span class='id identifier rubyid_turbo_stream'>turbo_stream</span><span class='period'>.</span><span class='id identifier rubyid_replace'>replace</span><span class='lparen'>(</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>notification_section</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
        <span class='label'>partial:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sensors/notification_section</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
        <span class='label'>locals:</span> <span class='lbrace'>{</span> <span class='label'>sensor:</span> <span class='ivar'>@sensor</span> <span class='rbrace'>}</span>
      <span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_plant_module_sensor_path'>plant_module_sensor_path</span><span class='lparen'>(</span><span class='ivar'>@sensor</span><span class='period'>.</span><span class='id identifier rubyid_plant_module'>plant_module</span><span class='comma'>,</span> <span class='ivar'>@sensor</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sun Apr 27 23:13:09 2025 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.37 (ruby-3.4.1).
</div>

    </div>
  </body>
</html>